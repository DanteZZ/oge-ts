{"version":3,"file":"instance.js","sourceRoot":"","sources":["../../../src/modules/instance.ts"],"names":[],"mappings":"AAAA,OAAO,YAAY,MAAM,uBAAuB,CAAC;AAIjD,MAAM,OAAO,cAAc;IAGzB,YAAY,MAAe;QACzB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC5B,CAAC;IAEM,SAAS,CAAC,MAAc;QAC7B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAEM,SAAS;QACd,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,OAAO,IAAI,CAAC,MAAM,CAAC;SACpB;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;SACjC;IACH,CAAC;IAEO,kBAAkB;QACxB,YAAY,CAAC,EAAE,CAAC,aAAa,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;QACpD,YAAY,CAAC,EAAE,CAAC,QAAQ,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;IAC/C,CAAC;IAEO,MAAM;QACZ,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;YAClC,IAAI;gBACF,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,MAAM,EAAE,CAAC;aACpB;YAAC,OAAO,CAAC,EAAE;gBACV,OAAO,CAAC,KAAK,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;aACzC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,IAAI;QACV,IAAI,CAAC,SAAS;aACX,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;aACjC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;YACpB,IAAI;gBACF,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aAC7B;YAAC,OAAO,CAAC,EAAE;gBACV,OAAO,CAAC,KAAK,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;aACvC;QACH,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,GAAG,CAAC,QAAoB;QAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC9B,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC1B,OAAO,QAAQ,CAAC;IAClB,CAAC;IAEM,YAAY,CAAC,SAAuB;QACzC,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;YAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC9B,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QACH,OAAO,SAAS,CAAC;IACnB,CAAC;IAEM,GAAG,CAAC,IAAY;QACrB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC;IAC3E,CAAC;IAEM,OAAO,CAAC,QAAoB;QACjC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC;IACtE,CAAC;IAEM,UAAU;QACf,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;QACnD,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACtB,CAAC;CACF","sourcesContent":["import eventEmitter from \"../utils/eventEmitter\";\nimport { Canvas } from \"../shared/Canvas\";\nimport { GameObject } from \"../shared/GameObject\";\n\nexport class InstanceBuffer {\n  private instances: GameObject[];\n  private canvas?: Canvas;\n  constructor(canvas?: Canvas) {\n    this.instances = [];\n    this.canvas = canvas;\n    this.initEventListeners();\n  }\n\n  public setCanvas(canvas: Canvas) {\n    this.canvas = canvas;\n  }\n\n  public getCanvas(): Canvas {\n    if (this.canvas) {\n      return this.canvas;\n    } else {\n      throw new Error(\"Empty canvas\");\n    }\n  }\n\n  private initEventListeners() {\n    eventEmitter.on(\"afterRender\", () => this.update());\n    eventEmitter.on(\"render\", () => this.draw());\n  }\n\n  private update(): void {\n    this.instances.forEach((instance) => {\n      try {\n        instance?.update();\n      } catch (e) {\n        console.error(\"Can't update\", instance);\n      }\n    });\n  }\n\n  private draw(): void {\n    this.instances\n      .sort((a, b) => a.depth - b.depth)\n      .forEach((instance) => {\n        try {\n          instance?.draw(this.canvas);\n        } catch (e) {\n          console.error(\"Can't draw\", instance);\n        }\n      });\n  }\n\n  public add(instance: GameObject): GameObject {\n    this.instances.push(instance);\n    instance._setBuffer(this);\n    return instance;\n  }\n\n  public addInstances(instances: GameObject[]): GameObject[] {\n    instances.forEach((instance) => {\n      this.instances.push(instance);\n      instance._setBuffer(this);\n    });\n    return instances;\n  }\n\n  public get(name: string): GameObject | null {\n    return this.instances.find((instance) => instance.name === name) || null;\n  }\n\n  public destroy(instance: GameObject) {\n    this.instances = this.instances.filter((inst) => inst !== instance);\n  }\n\n  public destroyAll() {\n    this.instances.forEach((inst) => inst.onDestroy());\n    this.instances = [];\n  }\n}\n"]}