{"version":3,"file":"sprite.js","sourceRoot":"","sources":["../../../src/modules/sprite.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AA0B1D,MAAM,OAAO,MAAM;IAWjB,YACE,KAAY,EACZ,OAAsB,IAAI,EAC1B,IAA2B;QAZpB,SAAI,GAAkB,IAAI,CAAC;QAE5B,UAAK,GAAW,CAAC,CAAC;QAClB,WAAM,GAAW,CAAC,CAAC;QACnB,WAAM,GAAW,CAAC,CAAC;QACnB,YAAO,GAAW,CAAC,CAAC;QACpB,YAAO,GAAW,CAAC,CAAC;QACpB,UAAK,GAAW,CAAC,CAAC;QAOxB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI;YACF,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;gBAC5C,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;YACpB,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,cAAc;QACnB,OAAO,IAAI,cAAc,CAAC,IAAI,CAAC,CAAC;IAClC,CAAC;IAEM,QAAQ,CAAC,KAAY;QAC1B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IACrB,CAAC;IAEM,OAAO,CAAC,KAAa,EAAE,MAAc;QAC1C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAEM,SAAS,CAAC,OAAe,EAAE,OAAe;QAC/C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,CAAC;IAEM,SAAS,CAAC,MAAc;QAC7B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAEM,OAAO;QACZ,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;QACrC,IAAI,GAAG,YAAY,gBAAgB,EAAE;YACnC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC;YACpC,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,GAAG,CAAC,MAAM,CAAC;YAEvC,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;gBACnB,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;aACxC;YAED,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC;SAC1B;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;SACpC;IACH,CAAC;IAEM,OAAO;QACZ,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC5B,uBACE,KAAK,EAAE,IAAI,CAAC,KAAK,EACjB,MAAM,EAAE,IAAI,CAAC,MAAM,EACnB,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,OAAO,EAAE,IAAI,CAAC,OAAO,IAClB,IAAI,EACP;IACJ,CAAC;IAEM,IAAI,CACT,MAAc,EACd,CAAS,EACT,CAAS,EACT,IAAyB;QAEzB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC3B,MAAM,CAAC,SAAS,CAAC;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO;YACnB,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO;YACnB,MAAM,EAAE,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,KAAI,GAAG,CAAC,KAAK;YAChC,OAAO,EAAE,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,MAAM,KAAI,GAAG,CAAC,MAAM;YACnC,MAAM,EAAE,GAAG,CAAC,KAAK;YACjB,OAAO,EAAE,GAAG,CAAC,MAAM;YACnB,OAAO,EAAE,CAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,KAAI,CAAC,CAAC,GAAG,GAAG,CAAC,KAAK;YACvC,OAAO,EAAE,CAAC;YACV,QAAQ,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ;YACxB,MAAM,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,MAAM;YACpB,OAAO,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,OAAO;SACvB,CAAC,CAAC;IACL,CAAC;CACF;AAED,MAAM,OAAO,OAAO;IAElB;QACE,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;IACpB,CAAC;IACM,MAAM,CACX,KAAY,EACZ,OAAsB,IAAI,EAC1B,IAA2B;QAE3B,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC1B,OAAO,MAAM,CAAC;IAChB,CAAC;IACM,GAAG,CAAC,IAAY;QACrB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC;IACrE,CAAC;CACF","sourcesContent":["import { Asset } from \"../utils/assets\";\nimport { Canvas } from \"../shared/Canvas\";\nimport { SpriteInstance } from \"../shared/SpriteInstance\";\n\nexport interface iSpriteInfo {\n  speed: number;\n  width: number;\n  height: number;\n  frames: number;\n  centerX: number;\n  centerY: number;\n  [key: string]: any;\n}\n\ninterface iSpriteSize {\n  width: number;\n  height: number;\n}\n\nexport interface iSpriteDrawOptions {\n  frame?: number;\n  rotation?: number;\n  opacity?: number;\n  filter?: string;\n  width?: number;\n  height?: number;\n}\n\nexport class Sprite {\n  [key: string]: any;\n  readonly name: string | null = null;\n  private asset: Asset;\n  private width: number = 0;\n  private height: number = 0;\n  private frames: number = 1;\n  private centerX: number = 0;\n  private centerY: number = 0;\n  private speed: number = 1;\n\n  constructor(\n    asset: Asset,\n    name: string | null = null,\n    opts?: Partial<iSpriteInfo>\n  ) {\n    this.asset = asset;\n    this.name = name;\n    opts &&\n      Object.entries(opts).forEach(([key, value]) => {\n        this[key] = value;\n      });\n  }\n\n  public createInstance(): SpriteInstance {\n    return new SpriteInstance(this);\n  }\n\n  public setAsset(asset: Asset): void {\n    this.asset = asset;\n  }\n\n  public setSize(width: number, height: number): void {\n    this.width = width;\n    this.height = height;\n  }\n\n  public setCenter(centerX: number, centerY: number): void {\n    this.centerX = centerX;\n    this.centerY = centerY;\n  }\n\n  public setFrames(frames: number): void {\n    this.frames = frames;\n  }\n\n  public getSize(): iSpriteSize {\n    const res = this.asset.getResource();\n    if (res instanceof HTMLImageElement) {\n      let width = this.width || res.width;\n      let height = this.height || res.height;\n\n      if (this.frames > 1) {\n        width = Math.ceil(width / this.frames);\n      }\n\n      return { width, height };\n    } else {\n      throw new Error(\"Undefined asset\");\n    }\n  }\n\n  public getInfo(): iSpriteInfo {\n    const size = this.getSize();\n    return {\n      speed: this.speed,\n      frames: this.frames,\n      centerX: this.centerX,\n      centerY: this.centerY,\n      ...size,\n    };\n  }\n\n  public draw(\n    canvas: Canvas,\n    x: number,\n    y: number,\n    opts?: iSpriteDrawOptions\n  ): void {\n    const inf = this.getInfo();\n    canvas.drawAsset({\n      asset: this.asset,\n      x: x - this.centerX,\n      y: y - this.centerY,\n      dWidth: opts?.width || inf.width,\n      dHeight: opts?.height || inf.height,\n      sWidth: inf.width,\n      sHeight: inf.height,\n      offsetX: (opts?.frame || 0) * inf.width,\n      offsetY: 0,\n      rotation: opts?.rotation,\n      filter: opts?.filter,\n      opacity: opts?.opacity,\n    });\n  }\n}\n\nexport class Sprites {\n  private sprites: Sprite[];\n  constructor() {\n    this.sprites = [];\n  }\n  public create(\n    asset: Asset,\n    name: string | null = null,\n    opts?: Partial<iSpriteInfo>\n  ): Sprite {\n    const sprite = new Sprite(asset, name, opts);\n    this.sprites.push(sprite);\n    return sprite;\n  }\n  public get(name: string): Sprite | null {\n    return this.sprites.find((sprite) => sprite.name === name) || null;\n  }\n}\n"]}