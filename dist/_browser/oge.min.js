!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OGE",[],t):"object"==typeof exports?exports.OGE=t():e.OGE=t()}(self,(()=>(()=>{"use strict";var e={150:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0,t.Camera=class{constructor(e,t){this.name=null,this.width=0,this.height=0,this.x=0,this.y=0,this.scene=e,this.trackInstance=t}update(e){let t=0,s=0;t=this.width?this.width:window.innerWidth,s=this.height?this.height:window.innerHeight,e.setSize(t,s),this.trackInstance&&(this.x=this.trackInstance.x-Math.ceil(t/2),this.y=this.trackInstance.y-Math.ceil(s/2)),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+t>this.scene.width&&(this.x=this.scene.width-t),this.y+s>this.scene.height&&(this.y=this.scene.height-s),t>this.scene.width&&(this.x=-(t-this.scene.width)/2),s>this.scene.height&&(this.y=-(s-this.scene.height)/2),e.setOffset(this.x,this.y)}setName(e){this.name=e}setScene(e){this.scene=e}setTrackInstance(e){this.trackInstance=e}}},485:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColliderBuffer=void 0;const i=s(61),n=s(667);t.ColliderBuffer=class{constructor(){this.colliders=[],this.initEventListeners()}add(e,t){const s=new n.Collider(this,e,t);return this.colliders.push(s),s}destroy(e){this.colliders=this.colliders.filter((t=>e!==t))}initEventListeners(){i.default.on("beforeUpdate",(()=>this.update()))}update(){this.colliders.forEach((e=>{e.collides=this.colliders.filter((t=>t!==e&&t.isIntersect(e)))}))}}},409:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceBuffer=void 0;const i=s(61);t.InstanceBuffer=class{constructor(e,t){this.instances=[],this.canvas=t,this.app=e,this.initEventListeners()}setCanvas(e){this.canvas=e}getCanvas(){if(this.canvas)return this.canvas;throw new Error("Empty canvas")}initEventListeners(){i.default.on("afterRender",(()=>this.update())),i.default.on("render",(()=>this.draw()))}update(){i.default.emit("beforeUpdate"),this.instances.forEach((e=>{try{null==e||e.update()}catch(t){console.error("Can't update",e)}})),i.default.emit("afterUpdate")}draw(){this.instances.sort(((e,t)=>e.depth-t.depth)).forEach((e=>{try{null==e||e.draw(this.canvas)}catch(t){console.error("Can't draw",e)}}))}add(e){return this.instances.push(e),e._setBuffer(this),e}addInstances(e){return e.forEach((e=>{this.instances.push(e),e._setBuffer(this),e.create()})),e}get(e){return this.instances.find((t=>t.name===e))||null}getAll(e){return this.instances.filter((t=>t.name===e))||null}destroy(e){this.instances=this.instances.filter((t=>t!==e))}destroyAll(){this.instances.forEach((e=>e.onDestroy())),this.instances=[]}}},118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SceneBuffer=t.Scene=void 0;const i=s(61),n=new(s(409).InstanceBuffer);t.Scene=class{constructor(){this.name=null,this.width=0,this.height=0,this.instances=n}_init(e){e.instanceBuffer.destroyAll(),this.init()}_update(e){this.camera&&e&&this.camera.update(e)}init(){}update(){}draw(e){}setCamera(e){this.camera=e}destroy(){var e;null===(e=null==this?void 0:this.buffer)||void 0===e||e.destroy(this)}getBuffer(){if(this.buffer)return this.buffer;throw new Error("Empty buffer")}getCanvas(){return this.getBuffer().getCanvas()}getInstanceBuffer(){if(this.instances)return this.instances;throw new Error("Empty buffer")}_setName(e){this.name=e}_setBuffer(e){this.buffer=e}_setInstanceBuffer(e){this.instances=e}},t.SceneBuffer=class{constructor(e,t,s){this.scenes=[],this.mainCanvas=s,this.context=e,t&&(this.add(t),this.selected=t),this.initEventListeners()}initScene(){this.selected&&this.selected._init(this.context)}setScene(e){return this.selected=e,this}setCanvas(e){return this.mainCanvas=e,this}getCanvas(){if(this.mainCanvas)return this.mainCanvas;throw new Error("Empty canvas")}initEventListeners(){i.default.on("beforeRender",(()=>this.update())),i.default.on("preRender",(()=>this.draw()))}update(){var e;this.selected&&(this.selected._update(this.mainCanvas),null===(e=this.selected)||void 0===e||e.update())}draw(){var e;this.mainCanvas&&this.selected&&(null===(e=this.selected)||void 0===e||e.draw(this.mainCanvas))}add(e){return this.scenes.push(e),e._setBuffer(this),e._setInstanceBuffer(this.context.instanceBuffer),e}get(e){return this.scenes.find((t=>t.name===e))||null}destroy(e){this.scenes=this.scenes.filter((t=>t!==e))}}},697:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sprites=t.Sprite=void 0;const i=s(394);class n{constructor(e,t=null,s){this.name=null,this.width=0,this.height=0,this.frames=1,this.centerX=0,this.centerY=0,this.speed=1,this.asset=e,this.name=t,s&&Object.entries(s).forEach((([e,t])=>{this[e]=t}))}createInstance(){return new i.SpriteInstance(this)}setAsset(e){this.asset=e}setSize(e,t){this.width=e,this.height=t}setCenter(e,t){this.centerX=e,this.centerY=t}setFrames(e){this.frames=e}getSize(){const e=this.asset.getResource();if(e instanceof HTMLImageElement){let t=this.width||e.width,s=this.height||e.height;return this.frames>1&&(t=Math.ceil(t/this.frames)),{width:t,height:s}}throw new Error("Undefined asset")}getInfo(){const e=this.getSize();return Object.assign({speed:this.speed,frames:this.frames,centerX:this.centerX,centerY:this.centerY},e)}draw(e,t,s,i){const n=this.getInfo();e.drawAsset({asset:this.asset,x:t-this.centerX,y:s-this.centerY,dWidth:(null==i?void 0:i.width)||n.width,dHeight:(null==i?void 0:i.height)||n.height,sWidth:n.width,sHeight:n.height,offsetX:((null==i?void 0:i.frame)||0)*n.width,offsetY:0,rotation:null==i?void 0:i.rotation,filter:null==i?void 0:i.filter,opacity:null==i?void 0:i.opacity})}}t.Sprite=n,t.Sprites=class{constructor(){this.sprites=[]}create(e,t=null,s){const i=new n(e,t,s);return this.sprites.push(i),i}get(e){return this.sprites.find((t=>t.name===e))||null}}},837:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(61),n=s(419),r=s(890),a=s(567),o=s(697),h=s(409),l=s(118),c=s(485);t.default=class{constructor(e){if(this.fps=0,this.deltaTime=0,this.lastDeltaTime=0,!e)throw new Error("Undefined element");this.graphic=new n.default(e),this.assets=new a.Assets,this.sprites=new o.Sprites,this.instanceBuffer=new h.InstanceBuffer(this),this.colliderBuffer=new c.ColliderBuffer,this.sceneBuffer=new l.SceneBuffer(this),this.events=i.default,this.input=r.default,this.initEventListeners()}initEventListeners(){this.events.on("afterRender",(()=>this.calculateDelta()))}calculateDelta(){this.fps=Math.round(1e3/(Date.now()-this.lastDeltaTime))+1,this.deltaTime=(Date.now()-this.lastDeltaTime)/1e3,this.lastDeltaTime=Date.now()}run(){this.graphic.playRender()}}},29:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;const i=s(567);t.Canvas=class{constructor(e,t,s,i){const n=document.createElement("canvas");n.className="_oge_canvas";const r=n.getContext("2d");if(!r)throw new Error("Can't create 2d context");this.ctx=r,this.name=t,this.element=n,this.offsetX=0,this.offsetY=0,this.setSize(s,i),e.appendChild(this.element)}drawAsset(e){const t=this.ctx;if(t){const s=e.asset.getResource();if(s instanceof HTMLImageElement){const i=e.sWidth||s.width,n=e.sHeight||s.height,r=e.dWidth||s.width,a=e.dHeight||s.height;e.rotation&&(t.save(),t.translate(e.x-this.offsetX+r/2,e.y-this.offsetY+a/2),t.rotate(e.rotation*Math.PI/180),t.translate(-(e.x-this.offsetX+r/2),-(e.y-this.offsetY+a/2))),e.filter&&(t.save(),t.filter=e.filter),1!==e.opacity&&(t.save(),t.globalAlpha=e.opacity||1),t.drawImage(s,e.offsetX||0,e.offsetY||0,i,n,e.x-(this.offsetX||0),e.y-(this.offsetY||0),r,a),e.rotation&&t.restore(),1!==e.opacity&&(t.restore(),t.globalAlpha=1),e.filter&&(t.restore(),t.filter="")}}}drawRect(e,t,s,n,r={strokeOnly:!1,stroked:!1,fixed:!1}){const a=this.ctx;if(a){let o="",h="";const l=r.fillStyle instanceof i.AssetPattern?r.fillStyle.getPattern():r.fillStyle,c=r.strokeStyle instanceof i.AssetPattern?r.strokeStyle.getPattern():r.strokeStyle;c&&(o=a.strokeStyle,a.strokeStyle=c),l&&(h=a.fillStyle,a.fillStyle=l);const f=r.fixed?0:this.offsetX,u=r.fixed?0:this.offsetY;r.strokeOnly||a.fillRect(e-f,t-u,s,n),(r.stroked||r.strokeOnly)&&a.strokeRect(e-f,t-u,s,n),r.strokeStyle&&(a.strokeStyle=o),r.fillStyle&&(a.fillStyle=h)}}drawArc(e,t,s,n=0,r=2*Math.PI,a={strokeOnly:!1,stroked:!1,fixed:!1}){const o=this.ctx;if(o){let h="",l="";const c=a.fillStyle instanceof i.AssetPattern?a.fillStyle.getPattern():a.fillStyle,f=a.strokeStyle instanceof i.AssetPattern?a.strokeStyle.getPattern():a.strokeStyle;f&&(h=o.strokeStyle,o.strokeStyle=f),c&&(l=o.fillStyle,o.fillStyle=c);const u=a.fixed?0:this.offsetX,d=a.fixed?0:this.offsetY;o.beginPath(),o.arc(e-u,t-d,s,n,r),a.strokeOnly||o.fill(),(a.stroked||a.strokeOnly)&&o.stroke(),a.strokeStyle&&(o.strokeStyle=h),a.fillStyle&&(o.fillStyle=l)}}drawText(e,t,s,n={strokeOnly:!1,stroked:!1,fixed:!1}){const r=this.ctx;if(r){let a="",o="",h="",l="left";const c=n.fillStyle instanceof i.AssetPattern?n.fillStyle.getPattern():n.fillStyle,f=n.strokeStyle instanceof i.AssetPattern?n.strokeStyle.getPattern():n.strokeStyle;f&&(a=r.strokeStyle,r.strokeStyle=f),c&&(o=r.fillStyle,r.fillStyle=c),n.font&&(h=r.font,r.font=n.font),n.textAlign&&(l=r.textAlign,r.textAlign=n.textAlign);const u=n.fixed?0:this.offsetX,d=n.fixed?0:this.offsetY;n.strokeOnly||r.fillText(e,t-u,s-d),(n.stroked||n.strokeOnly)&&r.strokeText(e,t-u,s-d),n.strokeStyle&&(r.strokeStyle=a),n.fillStyle&&(r.fillStyle=o),n.font&&(r.font=h),n.textAlign&&(r.textAlign=l)}}setOffset(e,t){this.offsetX=e,this.offsetY=t}setSize(e=0,t=0){let s,i;s=e||window.innerWidth,i=t||window.innerHeight,this.element.width!==s&&(this.element.width=s),this.element.height!==i&&(this.element.height=i)}}},667:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.Collider=t.eColliderType=void 0,function(e){e[e.rectangle=0]="rectangle",e[e.circle=1]="circle"}(s=t.eColliderType||(t.eColliderType={})),t.Collider=class{constructor(e,t,i){this.type=s.rectangle,this.collides=[],this.offsetX=0,this.offsetY=0,this.width=0,this.height=0,this.radius=0,this.instance=t,this.buffer=e,i&&Object.entries(i).forEach((([e,t])=>{this[e]=t}))}position(){return{x:this.instance.x+this.offsetX,y:this.instance.y+this.offsetY}}draw(e,t){e&&(this.type===s.rectangle?e.drawRect(this.position().x,this.position().y,this.width,this.height,{fillStyle:t||"rgba(3, 119, 252, .5)"}):e.drawArc(this.position().x,this.position().y,this.radius,void 0,void 0,{fillStyle:t||"rgba(3, 119, 252, .5)"}))}destroy(){this.buffer.destroy(this)}isIntersect(e,t=this){const[i,n]=[t,e];if(i.type===s.rectangle&&n.type===s.rectangle)return this.rectIntersect(i.position().x,i.position().y,i.width,i.height,n.position().x,n.position().y,n.width,n.height);if(i.type===s.circle&&n.type===s.circle)return this.circleIntersect(i.position().x,i.position().y,i.radius,n.position().x,n.position().y,n.radius);{const e=i.type===s.circle?i:n,t=i.type===s.rectangle?i:n;return this.circleRectIntersect(e.position().x,e.position().y,e.radius,t.position().x,t.position().y,t.width,t.height)}}rectIntersect(e,t,s,i,n,r,a,o){return!(n>s+e||e>a+n||r>i+t||t>o+r)}circleIntersect(e,t,s,i,n,r){return(e-i)*(e-i)+(t-n)*(t-n)<=(s+r)*(s+r)}circleRectIntersect(e,t,s,i,n,r,a){const o=Math.abs(e-i-r/2),h=Math.abs(t-n-a/2);if(o>r/2+s)return!1;if(h>a/2+s)return!1;if(o<=r/2)return!0;if(h<=r/2)return!0;const l=o-r/2,c=h-a/2;return l*l+c*c<=s*s}}},582:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0;const i=s(394);class n{constructor(e={}){this.name=null,this.x=0,this.y=0,this.depth=0,this.sprite=null,Object.entries(e).forEach((([e,t])=>{this[e]=t}))}create(){}update(){}draw(e){this.defaultDraw(e)}defaultDraw(e){e&&this.sprite instanceof i.SpriteInstance&&this.sprite.draw(e,this.x,this.y)}destroy(){var e,t;null===(e=null==this?void 0:this.collider)||void 0===e||e.destroy(),null===(t=null==this?void 0:this.buffer)||void 0===t||t.destroy(this)}onDestroy(){}getBuffer(){if(this.buffer)return this.buffer;throw new Error("Empty buffer")}createCollider(e){var t,s;this.collider=null===(s=null===(t=this.buffer)||void 0===t?void 0:t.app)||void 0===s?void 0:s.colliderBuffer.add(this,e)}isCollide(e,t=!1){let s=[];return this.collider&&(s=this.collider.collides.filter((t=>{var s;return e instanceof n?t===e.collider:(null===(s=t.instance)||void 0===s?void 0:s.name)===e}))),t?s:!!s.length}_setName(e){this.name=e}_setBuffer(e){this.buffer=e}}t.GameObject=n},394:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteInstance=void 0;const i=s(61);t.SpriteInstance=class{constructor(e){this.frame=0,this.speed=1,this.frameTime=Date.now(),this.sprite=e,this.initEventListeners()}initEventListeners(){i.default.on("afterRender",(()=>this.updateFrame()))}updateFrame(){const e=this.sprite.getInfo();e.frames>1&&this.speed>0&&e.speed>0&&Date.now()>=this.frameTime+e.speed/e.frames*1e3*this.speed&&(this.frameTime=Date.now(),this.frame==e.frames-1?this.frame=0:this.frame++)}getInfo(){return this.sprite.getInfo()}draw(e,t,s,i={}){this.sprite.draw(e,t,s,Object.assign({frame:this.frame},i))}}},567:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssetPattern=t.Assets=t.Asset=void 0;const i=s(126);class n{constructor(e,t=null){i.default.addToLoad(e),this.url=e,this.name=t}getResource(){return i.default.get(this.url)}}t.Asset=n,t.Assets=class{constructor(){this.assets=[]}create(e,t=null){const s=new n(e,t);return this.assets.push(s),s}createAssets(e){const t=[];return e.forEach((e=>t.push(this.create(e.url,e.name)))),t}get(e){return this.assets.find((t=>t.name===e))||null}getByUrl(e){return this.assets.find((t=>t.url===e))||null}loadAssets(){return new Promise(((e,t)=>{i.default.onReady(e),i.default.loadResources()}))}},t.AssetPattern=class{constructor(e,t,s="repeat"){this.pattern=null,this.type="repeat",this.canvas=e,this.asset=t,this.type=s}getPattern(){const e=this.asset.getResource();if(e instanceof HTMLImageElement){if(this.pattern||(this.pattern=this.canvas.ctx.createPattern(e,this.type)),this.pattern)return this.pattern;throw new Error("Pattern is not created")}throw new Error("Asset is not loaded")}}},61:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;class s{constructor(){this.events={},this.events={}}on(e,t){return"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"==typeof this.events[e]){const s=this.events[e].indexOf(t);s>-1&&this.events[e].splice(s,1)}}emit(e,t=null){"object"==typeof this.events[e]&&this.events[e].forEach((e=>{e.call(t)}))}once(e,t){const s=this.on(e,((...e)=>{s(),t.call(e)}))}}t.EventEmitter=s;const i=new s;t.default=i},419:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(29),n=s(61);t.default=class{constructor(e){this.canvasList=[],this.isRender=!1,this.rootElement=e}updateFrame(){this.isRender&&(this.clear(),n.default.emit("beforeRender"),n.default.emit("preRender"),n.default.emit("render"),n.default.emit("postRender"),n.default.emit("afterRender"),this.restore(),window.requestAnimationFrame((()=>{this.updateFrame()})))}stopRender(){this.isRender=!1}playRender(){this.isRender=!0,this.updateFrame()}getCanvas(e){var t;return(null===(t=this.canvasList)||void 0===t?void 0:t.find((t=>t.name===e)))||null}createCanvas(e,t=0,s=0){if(this.getCanvas(e))throw new Error(`Canvas "${e}" already exist`);{const n=new i.Canvas(this.rootElement,e,t,s);return this.canvasList.push(n),n}}clear(){this.canvasList.forEach((e=>{var t;return null===(t=e.ctx)||void 0===t?void 0:t.clearRect(0,0,e.element.width,e.element.height)}))}restore(){this.canvasList.forEach((e=>{var t;return null===(t=e.ctx)||void 0===t?void 0:t.restore()}))}setSize(e,t,s){const i="string"==typeof e?this.getCanvas(e):e;return!!i&&(i.setSize(t,s),!0)}setAllSizes(e,t){this.canvasList.forEach((s=>this.setSize(s,e,t)))}setOffset(e,t,s){const i=this.getCanvas(e);return!!i&&(i.setOffset(t,s),!0)}destroyCanvas(e){const t="string"==typeof e?this.getCanvas(e):e;t&&(t.element.remove(),this.canvasList=this.canvasList.filter((t=>t.name!==e)))}destroyAll(){this.canvasList.forEach((e=>this.destroyCanvas(e)))}drawAsset(e){if(e.canvas){let t=e.canvas instanceof i.Canvas?e.canvas:this.getCanvas(e.canvas);null==t||t.drawAsset(e)}}}},890:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InputBuffer=void 0;const i=s(61);class n{constructor(){this.inputBuffer={keys:{},mouseKeys:{},mouseX:0,mouseY:0},this.initEventListeners(),this.initDocEventListeners()}initEventListeners(){i.default.on("afterRender",(()=>{const e={};for(const t in this.inputBuffer.keys)"released"!==this.inputBuffer.keys[t]&&(e[t]=this.inputBuffer.keys[t]),"pressed"==this.inputBuffer.keys[t]&&(e[t]="hold");this.inputBuffer.keys=e;for(const t in this.inputBuffer.mouseKeys)"released"!==this.inputBuffer.mouseKeys[t]&&(e[t]=this.inputBuffer.mouseKeys[t]),"pressed"==this.inputBuffer.mouseKeys[t]&&(e[t]="hold");this.inputBuffer.mouseKeys={}}))}initDocEventListeners(){document.addEventListener("keydown",(e=>{const t=e.keyCode;null==this.inputBuffer.keys[t]?this.inputBuffer.keys[t]="pressed":this.inputBuffer.keys[t]="hold"})),document.addEventListener("keyup",(e=>{const t=e.keyCode;this.inputBuffer.keys[t]="released"})),document.onmousedown=e=>{const t=e.button;this.inputBuffer.mouseKeys[t]="pressed"},document.onmouseup=e=>{const t=e.button;this.inputBuffer.mouseKeys[t]="released"},document.onmousemove=e=>{this.inputBuffer.mouseX=e.clientX,this.inputBuffer.mouseY=e.clientY}}onKeyPress(e){return void 0!==this.inputBuffer.keys[e]&&"pressed"==this.inputBuffer.keys[e]}onKeyHold(e){return void 0!==this.inputBuffer.keys[e]&&"released"!==this.inputBuffer.keys[e]}onKeyRelease(e){return void 0!==this.inputBuffer.keys[e]&&"released"==this.inputBuffer.keys[e]}onMousePress(e){return void 0!==this.inputBuffer.mouseKeys[e]&&"pressed"==this.inputBuffer.mouseKeys[e]}onMouseHold(e){return void 0!==this.inputBuffer.mouseKeys[e]&&"released"!==this.inputBuffer.mouseKeys[e]}onMouseRelease(e){return void 0!==this.inputBuffer.mouseKeys[e]&&"released"==this.inputBuffer.mouseKeys[e]}}t.InputBuffer=n;const r=new n;t.default=r},126:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=new class{constructor(){this.loadQueue=[],this.resourceCache={},this.readyCallbacks=[]}addToLoad(e){e instanceof Array?e.forEach((e=>this.loadQueue.push(e))):this.loadQueue.push(e)}loadResources(e=null){if(e||(e=this.loadQueue),e instanceof Array)for(var t in e)this._load(e[t]);else this._load(e)}_load(e){if(this.resourceCache[e])return this.resourceCache[e];{const t={img:new Image,rl:this};return t.img.onload=()=>{if(this.resourceCache[e]=t.img,t.rl.isReady())for(var s in this.readyCallbacks)this.readyCallbacks[s]()},this.resourceCache[e]=!1,t.img.src=e,null}}get(e){return this.resourceCache[e]}isReady(){let e=!0;for(const t in this.resourceCache)this.resourceCache.hasOwnProperty(t)&&!this.resourceCache[t]&&(e=!1);return e}onReady(e){this.readyCallbacks.push(e)}};t.default=s}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}var i={};return(()=>{var e=i;const t=s(837);s(582),s(29),s(394),s(667);s(890).default;s(150),s(118),s(697),s(567);e.default=t.default})(),i.default})()));